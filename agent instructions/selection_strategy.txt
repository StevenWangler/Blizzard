AGENT SELECTION RULES:

IF no messages exist OR only USER message exists:
  RETURN: WeatherAgent

IF last message was from WeatherAgent:
  RETURN: Blizzard

IF last message was from Blizzard AND is first message (contains "Please analyze these weather conditions"):
  RETURN: BlizzardAssistant

IF last message was from Blizzard AND (contains "?" OR doesn't contain "FINAL SNOW DAY PREDICTION"):
  RETURN: BlizzardAssistant

IF last message was from BlizzardAssistant AND contains "PROBABILITY CALCULATION CONFIRMATION":
  RETURN: Blizzard

IF last message was from BlizzardAssistant AND contains "?":
  RETURN: Blizzard

IF last message was from BlizzardAssistant:
  RETURN: Blizzard

# Never end on BlizzardAssistant's confirmation without Blizzard's final response
IF last message was from BlizzardAssistant AND previous message was also from BlizzardAssistant:
  RETURN: Blizzard

IF last message was from Blizzard AND doesn't exactly match:
```
FINAL SNOW DAY PREDICTION

Based on our probability analysis:

[2-3 sentences explaining key probability factors]

Weather-Based Probability: [number]%
Community Experience Factor: [number]
Geographic Adjustment: [number]%

Final Snow Day Probability: [number]%
```
THEN: RETURN: BlizzardAssistant

# Ensure conversation continues if Blizzard hasn't given final format
IF NOT (last message was from Blizzard AND contains "FINAL SNOW DAY PREDICTION" AND contains "Final Snow Day Probability: [number]%"):
  IF last message was from Blizzard:
    RETURN: BlizzardAssistant
  ELSE:
    RETURN: Blizzard

MESSAGE FORMAT REQUIREMENTS:

WeatherAgent first message:
```
WEATHER ANALYSIS REPORT

Current Conditions:
- Temperature: [exact temp] 째F
- Wind Chill: [exact wind chill] 째F
- Precipitation: [type and amount]
- Wind: [speed] mph from [direction]
- Visibility: [exact] miles
- Ground Conditions: [current state]

Overnight Forecast (7 PM - 8 AM):
7 PM - 11 PM:
- Temperature Range: [low-high] 째F
- Wind Chill Range: [low-high] 째F
- Precipitation: [amount] inches of [type]
- Wind: [speed range] mph from [direction]
- Visibility: [range] miles

12 AM - 4 AM:
[Same metrics as above]

5 AM - 8 AM:
[Same metrics as above]

Active Weather Alerts:
- Alert Type: [exact alert name]
 Coverage: [specific areas affected]
 Timing: [start] to [end]
 Details: [specific alert details]
```

Blizzard first message:
```
Please analyze these weather conditions for snow day probability calculation.

Initial Weather Factors to Consider:
1. [List key weather metrics from report]
2. [List timing considerations]
3. [List geographic factors]

Questions for Analysis:
1. How should we weight these weather factors in our probability calculation?
2. What base probability do these conditions suggest?
3. How should we adjust for our community's experience level?
```

BlizzardAssistant first response:
```
PROBABILITY ANALYSIS

Weather Factor Weights:
1. [Factor 1]: X% weight because [reasoning]
2. [Factor 2]: Y% weight because [reasoning]
3. [Factor 3]: Z% weight because [reasoning]

Initial Probability Assessment:
- Base Weather Probability: X% because [detailed explanation]
- Suggested Community Factor: Y because [experience level analysis]
- Geographic Considerations: [specific to county/city]

Questions for Clarification:
1. [Specific question about calculations]
2. [Specific question about adjustments]
```

BlizzardAssistant final confirmation:
```
PROBABILITY CALCULATION CONFIRMATION

All factors have been properly calculated:
- Weather factors weighted appropriately
- Community experience factor applied correctly
- Geographic adjustments validated
- All calculations shown and justified

I confirm there are no remaining questions about the probability calculations.
```

Blizzard final format:
```
FINAL SNOW DAY PREDICTION

Based on our probability analysis:

[2-3 sentences explaining key probability factors]

Weather-Based Probability: [number]%
Community Experience Factor: [number]
Geographic Adjustment: [number]%

Final Snow Day Probability: [number]%
```

History:
{{$history}}

RESPOND WITH EXACTLY ONE OF THESE NAMES:
WeatherAgent
Blizzard
BlizzardAssistant